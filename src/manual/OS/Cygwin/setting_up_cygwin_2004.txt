

Installing cygwin for ESP-r use on a NT/W2K/WXP computer.

                February 2004 version

Using ESP-r on a PC requires a compatible operating environment.
This document discusses how to set the cygwin environment to 
provide the necessary display, command shell, and low-level 
library functions and system calls which ESP-r expects to find. 

Consider this a late-Beta release - setting up cygwin requires
several steps and the use of commands which will be familiar
to those who have used Unix/Linux. 

To find out more about cygwin start with their web page
<http://www.cygwin.com>. This document is based on
the Cgywin installer verion 2.416. To save time please review
the Cugwom site installation documentation in addition to the 
instructions which follow.

Before you download and install cygwin:

Prior to downloading and installing cygwin you need to setup
administrative and normal users on the PC so that your `login`
to cygwin is similar to that on a Linux or Unix computer. Typically
this involves an Administrator (who maintains the cygwin and ESP-r
applications) and a normal user who runs ESP-r.

Check that you have ~600 MB of free space for cygwin and ~200 MB
free for ESP-r and/or ~300 MB free for ESP-r and Radiance.

Installing cygwin:

If possible, become administrator to do the cygwin install. 
This makes the whole process easier than if you attempt the 
install as a normal user.

If you are installing Cygwin from an ISO image downloaded from the
ESRU ftp site follow the following instructions apply:

There is a windows executable named setup.exe
(which you run to install cygwin) on the CD. All the files
needed to install cgywin are included in the folder
cygwin_cache which you will point to as the local
download location. 

Setup.exe and it will ask the following questions:
  a) Where to get cygwin? Choose the "Install from local
     directory" and use browse to point to the cygwin_cache
     folder.

  b) Where to put it? Take the suggestion c:\cygwin and also
     the default option "all users" and "Unix file type".

After the setup process has checked that the files are ok 
it will present the packages to install. The top item will 
be "All : default" and if you toggle this to "All : install" 
you can proceed with the ->Next option. From this point
the setup will perform the same as with the web install
method. 

If you are installing from the web:

Point a web browser at <http://www.cygwin.com> and click on the "install
cygwin" icon. This will download a small setup.exe application (c:\TEMP
is a good place to put it) which will be used to download and install
cygwin components. This same tool can also be used to update cygwin.

Once downloaded run the setup.exe and it will ask the following
questions:
  a) Where to get cygwin? Choose the option "internet" if this if
     you have a fast connection and will be installing cygwin on
     one machine. Choose the "download" option if you want to install
     cygwin on more than one machine. Choose the "Install from local
     directory" if you have already downloaded a cygwin distribution
     or are doing it from a CD.

  b) Where to put it? Take the suggestion c:\cygwin and also
     the default option "all users" and "Unix file type".
     When asked about a "local package directory accept
     "c:\TEMP" if internet or download, or point to a folder
     with previously downloaded files if that is the approach
     you are taking.
 
  c) For an internet or download install you may have to set an
     appropriate proxy (In the University of Strathclyde this is:
     www-cache.strath.ac.uk port 8080)

  d) Select a download site. In the UK ftp.ftp.mirror.ac.uk is 
     quite fast.

Once the ftp site has been reached is to select the packages to
install. If disk space is not a problem you can select all by
toggling the "All -> default" to "All -> Install". Note that the
installer might take several minutes to react to this request.

If you want to be selective (and save download time and disk space)
the following is a useful guide:

 admin:        tick all
 archive:      tick all
 base install: tick all but gdbm, libgdbm, libgdbm-devel
 database:     optional
 development:  tick ELFIO, autoconf, automake, binutils,
               dpkg, gcc, gcc-mingw, gdb. make, 
               mingw-runtime, mktemp
 doc:          optional but at least get the man pages
 editors:      at least nedit, vim & midnight commander
 games:        optional
 graphics:     tick ImageMagic, ghostscript, jpeg, libpng,
               opengl,tiff and image libraries
 intepretors:  tick expect, gawk, m4, perl 
 libraries:    tick all except guile and tetext
 mail:         optional
 math:         optional
 net:          tick openssh, setup, inetutils rsync.
 publishing:   optional
 shells:       pick all
 system:       pick procps, 
 text:         pick enscript, groff, gv,less, more, textinfo
 utils:        pick bzip2, clear, cygutils, file, gnupg, keychain,
               patch, time, units
 web:          optional (wget is useful)
 XFree86:      pick at least one window manager (fvfwm is a minimal one) 
               as well as Xfree86-base, Xfree86-bin, Xfree86-etc, 
               Xfree86-fenc, Xfree86-fnts, Xfree86-fscl, Xfree86-fsrv,
               Xfree86-lib, Xfree86-prog, Xfree86-startup-scripts,
               Xaw3D, Xfree86-xserv, Xfree86-xwinclip, grace, 
               lesstif, transfig and xfig.
                .
After completing the list the installer will download the various
packages and put an icon on the desktop.

The cygwin site has a related sites link <http://cygwin.com/links.html>
with ported software.


Post-install patches:

Once Cygwin is installed you can move on to the 2nd stage of 
installing ESP-r and, optionally Radiance. If you have downloaded an
ISO file then you can take the `shortcut` instructions, otherwise
you will need to follow the `compile` instructions.

Shortcut instructions:

Click on the Cygwin icon on your desktop
to start up a cyginw window. This emulates a Linux
machine within your PC. Use Linux commands to go to
the /tmp folder or create such a folder if it does not
exist.

The first time you log in as each user, Cygwin
will create some `dot` (environment settings) files
in your home folder. If you log in as Ralph
you should be located in /home/Ralph after you
log in.

Next find out what drive cygwin thinks this
CD or zip drive is by issuing a df command.
You should see a /cygdrive/c and probably 
a /cygdrive/d and/or a /cygdrive/e. 

There are several scripts do_copy_d.csh do_copy_e.csh,
do_copy_f.csh, do_copy_g.csh which you will use depending
on which drive windows has assigned. You need to copy
this script plus the do_this_next.csh script to
/tmp. A typical command sequence (for drive f) would be:
cd /tmp
cp /cygdrive/f/do_copy_f.csh .
cp /cygdrive/f/do_this_next.csh .
./do_copy_f.csh
./do_this_next.csh

These steps will gather the relevant files from the
distribution medium, copy them to /tmp and then expand
them into their proper locations with the cygwin file
structure. When you run the do_this_next.csh script
there will be some messages printed out on the
Cygwin console. These involve copying some `dot` files
from the /tmp folder into each users home folder.
Be sure to do this!

If the scripts do not run you might need to make the
scripts executable by issuing a chmod a+x xx.csh command
(where xx stands for the relevant script).

If the above steps were completed sucessfully then you 
need to log out and restart cygwin. This forces the
environment variables to be set for this user. To find
out what to do next skip to the section following compile
instructions.
 
Compile instructions:

Once Cygwin is installed you need to alter several files so that
cygwin starts with an appropriate PATH environment variable. There are
variants of the do_copy_f.csh and ./do_this_next.csh
commands for the case of a `compile` install. 

First find out what drive cygwin thinks this
CD or zip drive is by issuing a df command.
You should see a /cygdrive/c and probably 
a /cygdrive/d and/or a /cygdrive/e. 

There are several scripts do_copy_d_compile.csh do_copy_e_compile.csh,
do_copy_f_compile.csh, do_copy_g_compile.csh which you will use depending
on which drive windows has assigned. You need to copy
this script plus the do_this_next_compile.csh script to
/tmp. A typical command sequence (for drive f) would be:
cd /tmp
cp /cygdrive/f/do_copy_f_compile.csh .
cp /cygdrive/f/do_this_next_compile.csh .
./do_copy_f_compile.csh
./do_this_next_compile.csh

These steps will gather the relevant files from the
distribution medium, copy them to /tmp and then expand
them into their proper locations with the cygwin file
structure. It will also create folders /usr/esru/bin 
/usr/esru/esp-r /usr/esru/esp-r/bin /usr/esru/esp-r/lib
/usr/esru/esp-r/climate /usr/esru/esp-r/manual if they
do not already exist.

Issue the command "logout" or "exit" in the Cygwin command
window and then click on the cygwin icon on the desktop
to re-establish the PATH environment variable and get an intial
cygwin command shell window. 

Standard cygwin will install a g77 compiler in /usr/bin/g77
and there should also be a f77 link. If you issue the command
which f77 you should get /usr/bin/f77. If you do not, you 
should create a link to f77 as follows
  cd /usr/bin
  ln -s /usr/bin/g77 /usr/bin/f77

To compile ESP-r you then download the standard distribution
compress tar files from <http://www.esru.strath.ac.uk> along
with the unpacklinux script.

Place the downloaded source distribution in a folder such
as /home/esru/src/esp-r and run the unpacklinux script (you
may have to enable the unpacklinux script by running a
chmod a+x command on it first).

You whould find a file Install in the source distribution folder.
Install when run will have an option for a compile under the
Cygwin environment. The compile process should proceed much
as it does under Solaris or Linux or OS X. You will be asked
if you want to install training files [say yes] and databases
[say yes].

After ESP-r install:

Typically users will start up an X display desktop and work within
that. To have a reasonable cygwin desktop you need to have a file
called .xinitrc in the home folder of each user. If you are
installing Cygwin via an ISO image then there will be a number
of `dot` files in /tmp and these should be copied to each users
home folder. Otherwise download the files from the
ESRU/cygwin site or create a file with the following text
in it and name it .xinitrc

exec >$HOME/.x11startlog 2>$HOME/.x11startlog 
xsetroot -bitmap .esru.x
xterm -name Console -fn 6x13 -C -g 85X8+0+0 &
xterm -name Xterm1 -fn 6x13 -g 85X35+0-0 -sb -sl 400 &
xterm -name Xterm2 -fn 6x13 -g 80X24+350-50 -sb -sl 400 &
xclock -g 75X75-60+0 &
xstdcmap -delete all
exec twm

The above command (or the standard `dot` files) will start 
a clock, three command shells and the "twm" window manager. 
The xsetroot assumes that you have also downloaded or copied
from /tmp a  file .esru.x. You can substitute a different
X bitmap file or remove this line if you want a simple
background.
 
To invoke the X display desktop there are two approaches.  The first
opens a window that takes up the whole screen area (except for the
standard toolbar), the second opens a window of a specified size within
the screen (recommended as you can still see the Windows desktop).

Command a:
  startx

Command b:
  startx -- -screen 0 900 700

The window in command b will be 900 pixels wide by 700 pixels
high and will have three X terminals running in it along with
a clock. The second approach make it easy to interact with
your windows environment. 

Once you have Cygwin properly installed and your environment
setup ESP-r will think that it is running on a Linux box, indeed 
it should work with simulation models created on another PC 
based Linux. You can invoke ESP-r from an `xterm` window 
in graphics mode after you have started cygwin and started 
the X server. Simply type the command esp-r.

Radiance install:

It is also possible to compile the current distribution of
the Radiance package in the cygwin environment. Note that
the tiff related modules tend not to compile, but none of
these is essential for use with ESP-r. Out-of-the-box
a Radiance compile will fail in several places and you will
have to manually copy quite a few of the executables and
shell scripts to their proper location. The ISO download
includes a tar file of a pre-compiled Radiance distribution
sufficient for use with ESP-r. It is recommended that you
use that if at all possible.

